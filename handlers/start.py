from aiogram import Router, types, F
from aiogram.filters import Command
from database import Database
from keyboards import get_main_kb_no_family, get_main_kb_with_family

router = Router()
db = Database('space.db')


@router.message(Command("start"))
async def cmd_start(message: types.Message):
    user_id = message.from_user.id
    username = message.from_user.username or "SpaceTraveller"

    db.add_user(user_id, username)
    family_id = db.get_user_family(user_id)

    if family_id:
        info = db.get_family_info(family_id)
        # info: 0=name, ..., 5=planet

        text = (
            f"üü¢ **–°–ò–°–¢–ï–ú–ê –Ü–î–ï–ù–¢–ò–§–Ü–ö–ê–¶–Ü–á: –£–°–ü–Ü–•**\n"
            f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
            f"üë§ –ü—ñ–ª–æ—Ç: **{username}**\n"
            f"üöÄ –ï–∫—ñ–ø–∞–∂: **{info[0]}**\n"
            f"üìç –ü–æ—Ç–æ—á–Ω–∞ –±–∞–∑–∞: **{info[5]}**\n"
            f"‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n"
            f"–û—á—ñ–∫—É—é –≤–∞—à–∏—Ö –≤–∫–∞–∑—ñ–≤–æ–∫ —á–µ—Ä–µ–∑ –±–æ—Ä—Ç–æ–≤–∏–π –∫–æ–º–ø'—é—Ç–µ—Ä üëá"
        )
        await message.answer(text, parse_mode="Markdown", reply_markup=get_main_kb_with_family())
    else:
        text = (
            f"üåå **–õ–ê–°–ö–ê–í–û –ü–†–û–°–ò–ú–û –î–û ROCKET LAB** üåå\n\n"
            f"–í–∏ ‚Äî –Ω–æ–≤–∏–π —É—á–∞—Å–Ω–∏–∫ –∫–æ—Å–º—ñ—á–Ω–æ—ó –ø—Ä–æ–≥—Ä–∞–º–∏. –í–∞—à–∞ –º–µ—Ç–∞ ‚Äî –ø—ñ–¥–∫–æ—Ä–∏—Ç–∏ –°–æ–Ω—è—á–Ω—É —Å–∏—Å—Ç–µ–º—É, –≤—ñ–¥ –ó–µ–º–ª—ñ –¥–æ –Æ–ø—ñ—Ç–µ—Ä–∞.\n\n"
            f"‚ö†Ô∏è **–í–ê–ñ–õ–ò–í–û:** –û–¥–∏–Ω–∞–∫–∞–º —Ç—É—Ç –Ω–µ –≤–∏–∂–∏—Ç–∏. –í–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ:\n"
            f"1Ô∏è‚É£ –°—Ç–≤–æ—Ä–∏—Ç–∏ –≤–ª–∞—Å–Ω—É –∫–æ—Å–º—ñ—á–Ω—É —Å—ñ–º'—é (–µ–∫—ñ–ø–∞–∂).\n"
            f"2Ô∏è‚É£ –ê–±–æ –ø—Ä–∏—î–¥–Ω–∞—Ç–∏—Å—è –¥–æ –¥—Ä—É–∑—ñ–≤ –∑–∞ –∫–æ–¥–æ–º.\n\n"
            f"üëá **–û–±–µ—Ä—ñ—Ç—å –¥—ñ—é –¥–ª—è –ø–æ—á–∞—Ç–∫—É:**"
        )
        await message.answer(text, parse_mode="Markdown", reply_markup=get_main_kb_no_family())


@router.message(Command("help"))
@router.message(F.text == "‚ÑπÔ∏è –î–æ–ø–æ–º–æ–≥–∞")
async def cmd_help(message: types.Message):
    text = (
        "üìò **–ë–û–†–¢–û–í–ò–ô –ñ–£–†–ù–ê–õ: –Ü–ù–°–¢–†–£–ö–¶–Ü–Ø**\n"
        "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n"
        "üöÄ **–ú–Ü–°–Ü–á**\n"
        "–í—ñ–¥–ø—Ä–∞–≤–ª—è–π—Ç–µ —Ä–∞–∫–µ—Ç–∏ –∑–∞ —Ä–µ—Å—É—Ä—Å–∞–º–∏. –£–≤–∞–≥–∞ –Ω–∞ **–†–∏–∑–∏–∫** (‚ò†Ô∏è)! –Ø–∫—â–æ —Ä–∏–∑–∏–∫ –≤–∏—Å–æ–∫–∏–π, –Ω–∞ –≤–∞—Å –º–æ–∂—É—Ç—å –Ω–∞–ø–∞—Å—Ç–∏ –ø—ñ—Ä–∞—Ç–∏. –ö–∞—á–∞–π—Ç–µ **–ö–æ—Ä–ø—É—Å**, —â–æ–± –∑–∞—Ö–∏—Å—Ç–∏—Ç–∏—Å—å.\n\n"
        "üè≠ **–Ü–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê**\n"
        "–ë—É–¥—É–π—Ç–µ —à–∞—Ö—Ç–∏ –¥–ª—è –ø–∞—Å–∏–≤–Ω–æ–≥–æ –≤–∏–¥–æ–±—É—Ç–∫—É. –†–µ—Å—É—Ä—Å–∏ –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–ª—è –∫—Ä–∞—Ñ—Ç—É —Ç–∞ –ø–æ–ª—å–æ—Ç—ñ–≤.\n\n"
        "‚öîÔ∏è **–í–Ü–ô–ù–ê (PvP)**\n"
        "–ù–∞ –ú–∞—Ä—Å—ñ —Ç–∞ –Æ–ø—ñ—Ç–µ—Ä—ñ –Ω–µ–º–∞—î –∑–∞–∫–æ–Ω—ñ–≤. –í–∏ –º–æ–∂–µ—Ç–µ –∞—Ç–∞–∫—É–≤–∞—Ç–∏ —ñ–Ω—à—ñ —Å—ñ–º'—ó —Ç–∞ –≥—Ä–∞–±—É–≤–∞—Ç–∏ —ó—Ö–Ω—ñ —Å–∫–ª–∞–¥–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ç–∞–∫—Ç–∏–∫—É!\n\n"
        "üõ∏ **–ê–ù–ì–ê–† (WEB)**\n"
        "–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É ¬´–ê–Ω–≥–∞—Ä¬ª, —â–æ–± –≤—ñ–¥–∫—Ä–∏—Ç–∏ –≤—ñ–∑—É–∞–ª—å–Ω–∏–π —Ç–µ—Ä–º—ñ–Ω–∞–ª –∫–µ—Ä—É–≤–∞–Ω–Ω—è.\n\n"
        "üõí **–ú–ê–ì–ê–ó–ò–ù**\n"
        "–¢—É—Ç –º–æ–∂–Ω–∞ –ø–æ–∫—Ä–∞—â–∏—Ç–∏ –¥–≤–∏–≥—É–Ω (—à–≤–∏–¥–∫—ñ—Å—Ç—å/–∞—Ç–∞–∫–∞) —Ç–∞ –∫–æ—Ä–ø—É—Å (–∑–∞—Ö–∏—Å—Ç)."
    )
    # –¢—É—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ answer, –±–æ —Ü–µ –¥–æ–≤—ñ–¥–∫–∞, —è–∫—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —Ö–æ—á–µ –±–∞—á–∏—Ç–∏ –æ–∫—Ä–µ–º–æ
    await message.answer(text, parse_mode="Markdown")